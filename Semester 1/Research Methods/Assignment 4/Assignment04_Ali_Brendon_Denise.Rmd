---
title: "Assignment4: Incomplete Counterbalancing"
author: "Denise Lee, Brendon Ngo & Ali Taheri "
date: "October 30, 2017"
output:
  html_document:
    toc: TRUE
    toc_float: TRUE
    theme: spacelab
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Problem Statement

You want to conduct an experiment to test the effect of a new drug for treating children with attention deficit disorder. You have decided to test six different amounts of the new drug-5, 7, 9, 11, 13, and 15 mg. The parents of 40 children with attention deficit disorder have volunteered their child to participate in the study. You know that using this procedure might result in either carryover or order effects, so you want to counterbalance the order of presentation of the six dosages. Construct the different counterbalanced order of treatment conditions using the incomplete counterbalancing technique in r markdown.

## Objective

To counterbalance the order of six dosages using the incomplete counterbalancing technique.

## Method

The incomplete counterbalancing technique uses the formula 1, 2, n, 3, (n-1), 4, (n-2), 5...to generate the first unique sequence for n number of treatments. Subsequent sequences are created by adding 1 to each number in the sequence; if the number is n, the next number will be 1.

### Create counterbalance function

Create a function for generating required sequences.The sequences must meet the following criteria:

1. Each treatment must appear the same amount of times in each ordinal position.
2. Each treatment must be preceded by and followed by each other treatment condition an equivalent amount of times.

```{r incomplete counterbalancing function, warning=FALSE}
#Counterbalance function of 'n', where n = the number of different treatment dosages
incomplete.counterbalance <-function(n){
  result.matrix=matrix(rep(0,n*n),nrow=n)
  result.matrix[1,1:2]=1:2
  result.matrix[1,3]=n
  for (i in 4:n){
    result.matrix[1,i]=result.matrix[1,i-2]+(-1)^(i%%2)
  }
  for ( k in 2:n){
    for (i in 1:n){
    if (result.matrix[k-1,i] != n) result.matrix[k,i]=result.matrix[k-1,i]+1 else
      result.matrix[k,i]=1
    }
  }
  result.matrix=switch(n%%2+1,result.matrix,rbind(result.matrix,n+result.matrix*((result.matrix %/% n)-1)))
 return(result.matrix)
}

```


### Test Function (n = 7)

The function was tested on an odd number of treatments (n = 7). Based on the formula used, an odd number of treatments will also require the reverse of each sequence in order to meet the two conditions for incomplete counterbalancing method.

```{r incomplete counterbalancing for odd number of sequences, warning=FALSE}
print(incomplete.counterbalance(7))
```

### Generate sequences for study (n = 6)

In this study there are six different dosage treatments (5mg, 7mg, 9mg, 11mg, 13mg, 15mg), therefore n=6. Since n is even, the required number of sequences will be equal to the total number of treatments n order to meet the condtions for incomplete counterbalancing.


```{r incomplete counterbalancing for 6 dosages, warning=FALSE}
final.sequences=data.frame(2*incomplete.counterbalance(6)+3)
final.sequences[]=lapply(final.sequences, function(x) paste0( x,"mg"))
print(final.sequences)
```

## Result

In this study there are six different dosage treatments, therefore n=6. Since the n is even, the required number of sequences will be equal to the total number of treatments. Each sequence is shown in the rows of the matrix generated by the incomplete counterbalance function.

### Assignment of participants to groups

As shown in the matrix above, six sequences of treatments are required; therefore, 6 groups of participants are required in order to assign one group to each treatment sequence. Out of the 40 available study subjects, 36 of the available individuals will randomly assigned to one of the 6 groups. The six groups will be randomly assigned, one to each sequence. <br>
